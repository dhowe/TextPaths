<html>
<head>
  <meta charset="UTF-8">
  <script src="lib/munkres.js"></script>
  <script src="lib/p5.js"></script>
  <script src="vehicle.js"></script>
  <script src="wordlist.js"></script>
  <script src="texticle.js"></script>
</head>
<script>

// NEXT: handle alignments?
//   implement Texticle.morph()

var txt,bb;
function setup() {

  createCanvas(600, 400);
  background(245);
  loadFont('fonts/ArialUnicode.ttf', function(f) {
    textFont(f);
    renderPair();
  });
}

function draw() {

  background(0);
  txt&& txt.draw();
  //bb && rect(bb.x,bb.y,bb.w,bb.h);
}

function renderPair() {

  var font = textFont(), keys = Object.keys(words),
    word = keys[floor(random(keys.length))]

  var metrics = fontSizeForBounds(font, word, width-100, height-100);
  textSize(metrics.fontSize);
  txt && txt.morph(word, 50, height/2 + metrics.h/2);
  txt = new Texticle(word, 50, height/2 + metrics.h/2);

  setTimeout(function() {

    var metrics = fontSizeForBounds(font, words[word], width-100, height-100);
    textSize(metrics.fontSize);
    txt.morph(words[word], 50, height/2 + metrics.h/2);
    txt = new Texticle(words[word], 50, height/2 + metrics.h/2);


    setTimeout(renderPair, 2000);

  }, 2000);
}

function fontSizeForBounds(font, text, boundsWidth, boundsHeight) {

  boundsWidth = boundsWidth;
  boundsHeight = boundsHeight;
  var fontSize = 12, bbox = { w: 0, h: 0 };
  while (bbox.w < boundsWidth && bbox.h < boundsHeight) {
    bbox = font.textBounds(text, 0, 0, fontSize += 2);
  }
  bbox.fontSize = fontSize;
  return bbox; // returns {x,y,w,h,fontSize}
}
</script>
</html>
